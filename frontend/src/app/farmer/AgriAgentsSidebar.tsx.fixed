'use client';

import { useRouter, usePathname } from "next/navigation";
import { 
  Sprout, Map, TestTube, Droplets, Shield, Tractor, ShoppingCart,
  ChevronLeft, ChevronRight, Beaker, Package, Award, Truck, Star, Building,
  CalendarDays, Settings, Bell, ClipboardCheck 
} from "lucide-react";
import { Button } from "./ui/button";
import { Card } from "./ui/card";
import { useState } from "react";

interface SubRoute {
  name: string;
  route: string;
  icon: any;
}

interface AgentType {
  name: string;
  telugu: string;
  icon: any;
  route: string;
  description: string;
  subRoutes?: SubRoute[];
  services?: any[];
}

const agriAgents: AgentType[] = [
  {
    name: "Land Mapping",
    telugu: "‡∞≠‡±Ç‡∞Æ‡∞ø ‡∞Æ‡±ç‡∞Ø‡∞æ‡∞™‡∞ø‡∞Ç‡∞ó‡±ç",
    icon: Map,
    route: "/farmer/land-mapping",
    description: "Precision land boundary mapping",
  },
  {
    name: "SoilSense",
    telugu: "‡∞Æ‡∞ü‡±ç‡∞ü‡∞ø ‡∞µ‡∞ø‡∞∂‡±ç‡∞≤‡±á‡∞∑‡∞£",
    icon: TestTube,
    route: "/farmer/soil-sense",
    description: "Advanced soil health analysis",
  },
  {
    name: "SeedPlanner",
    telugu: "‡∞µ‡∞ø‡∞§‡±ç‡∞§‡∞® ‡∞™‡±ç‡∞≤‡∞æ‡∞®‡∞ø‡∞Ç‡∞ó‡±ç",
    icon: Sprout,
    route: "/farmer/seed-planner",
    description: "Smart crop and seed selection",
  },
  {
    name: "AquaGuide",
    telugu: "‡∞®‡±Ä‡∞ü‡∞ø‡∞™‡∞æ‡∞∞‡±Å‡∞¶‡∞≤",
    icon: Droplets,
    route: "/farmer/aqua guide",
    description: "Intelligent irrigation scheduling",
    subRoutes: [
      {
        name: "Scheduling",
        route: "/farmer/aqua guide/scheduling",
        icon: CalendarDays,
      },
      {
        name: "Equipment",
        route: "/farmer/aqua guide/equipment",
        icon: Settings,
      },
      {
        name: "Alerts",
        route: "/farmer/aqua guide/alerts",
        icon: Bell,
      },
      {
        name: "Compliance",
        route: "/farmer/aqua guide/compliance",
        icon: ClipboardCheck,
      },
    ],
  },
  {
    name: "CropShield",
    telugu: "‡∞™‡∞Ç‡∞ü ‡∞∞‡∞ï‡±ç‡∞∑‡∞£",
    icon: Shield,
    route: "/farmer/cropshield",
    description: "Pest and disease detection",
  },
  {
    name: "NutriDose",
    telugu: "‡∞™‡±ã‡∞∑‡∞ï‡∞æ‡∞≤‡±Å",
    icon: Beaker,
    route: "/farmer/nutridose",
    description: "Nutrition management system",
  },
  {
    name: "HarvestBot",
    telugu: "‡∞ï‡±ã‡∞§ ‡∞Ø‡∞Ç‡∞§‡±ç‡∞∞‡∞Ç",
    icon: Tractor,
    route: "/farmer/harvestbot",
    description: "Automated harvest planning",
  },
  {
    name: "StorageGuard",
    telugu: "‡∞®‡∞ø‡∞≤‡±ç‡∞µ ‡∞∞‡∞ï‡±ç‡∞∑‡∞£",
    icon: Building,
    route: "/farmer/storageguard",
    description: "Post-harvest storage management",
  },
  {
    name: "MarketConnect",
    telugu: "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞ï‡∞®‡±Ü‡∞ï‡±ç‡∞ü‡±ç",
    icon: ShoppingCart,
    route: "/farmer/marketconnect",
    description: "Connect with buyers",
  },
];

const agriHubExtension: AgentType[] = [
  {
    name: "Processing Hub",
    telugu: "‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡∞ø‡∞Ç‡∞ó‡±ç ‡∞π‡∞¨‡±ç",
    icon: Package,
    route: "/farmer/processinghub",
    description: "AI-powered food processing",
    services: [/* Your existing services */]
  },
  {
    name: "Quality Assurance",
    telugu: "‡∞®‡∞æ‡∞£‡±ç‡∞Ø‡∞§ ‡∞π‡∞æ‡∞Æ‡±Ä",
    icon: Award,
    route: "/farmer/qualityassurance",
    description: "Blockchain certification",
    services: [/* Your existing services */]
  },
  {
    name: "Packaging & Branding",
    telugu: "‡∞™‡±ç‡∞Ø‡∞æ‡∞ï‡±á‡∞ú‡∞ø‡∞Ç‡∞ó‡±ç",
    icon: Package,
    route: "/farmer/packagingbranding",
    description: "Eco-friendly packaging",
    services: [/* Your existing services */]
  },
  {
    name: "Consumer Delivery",
    telugu: "‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä",
    icon: Truck,
    route: "/farmer/consumer-delivery",
    description: "Direct farm-to-consumer",
    services: [/* Your existing services */]
  },
  {
    name: "Consumer Feedback",
    telugu: "‡∞™‡±ç‡∞∞‡∞§‡∞ø‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞®",
    icon: Star,
    route: "/farmer/consumer-feedback",
    description: "AI-powered analytics",
    services: [/* Your existing services */]
  }
];

const AgriAgentsSidebar = () => {
  const router = useRouter();
  const pathname = usePathname();
  const [collapsed, setCollapsed] = useState(false);

  const handleNavigation = (path: string) => {
    router.push(path);
  };

  const isActive = (path: string) => pathname === path || pathname.startsWith(path + "/");

  return (
    <div
      className={`${
        collapsed ? "w-16" : "w-80"
      } transition-all duration-300 h-screen bg-card/95 backdrop-blur-sm border-r border-border flex flex-col fixed left-0 top-0 z-[100] shadow-2xl`}
    >
      <div className="p-4 border-b border-border flex items-center justify-between bg-background/50">
        {!collapsed && (
          <h2 className="text-lg font-bold text-foreground">
            AI Agents | ‡∞è‡∞ú‡±Ü‡∞Ç‡∞ü‡±ç‡∞≤‡±Å
          </h2>
        )}
        <Button
          variant="ghost"
          size="sm"
          onClick={() => setCollapsed(!collapsed)}
          className="p-2 hover:bg-accent"
        >
          {collapsed ? (
            <ChevronRight className="w-4 h-4" />
          ) : (
            <ChevronLeft className="w-4 h-4" />
          )}
        </Button>
      </div>

      <div className="flex-1 overflow-y-auto p-2 space-y-4">
        <div className="space-y-2">
          {!collapsed && (
            <div className="px-2 py-1">
              <h3 className="text-xs font-semibold text-muted-foreground uppercase tracking-wider">
                Core Agents
              </h3>
            </div>
          )}
          {agriAgents.map((agent) => {
            const IconComponent = agent.icon;
            const active = isActive(agent.route);

            return (
              <div key={agent.route} className="space-y-1">
                <Card
                  className={`cursor-pointer transition-all duration-200 border hover:shadow-md ${
                    active
                      ? "bg-primary/10 border-primary shadow-md ring-1 ring-primary/20"
                      : "bg-card hover:bg-accent/50 border-border"
                  }`}
                  onClick={() => handleNavigation(agent.route)}
                >
                  <div className="p-3">
                    <div className="flex items-center gap-3">
                      <div
                        className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all ${
                          active
                            ? "bg-primary text-primary-foreground"
                            : "bg-gradient-to-br from-primary to-accent text-white"
                        }`}
                      >
                        <IconComponent className="w-5 h-5" />
                      </div>

                      {!collapsed && (
                        <div className="flex-1 min-w-0">
                          <h3
                            className={`font-semibold text-sm transition-colors ${
                              active ? "text-primary" : "text-foreground"
                            }`}
                          >
                            {agent.name}
                          </h3>
                          <p className="text-xs text-accent font-medium truncate">
                            {agent.telugu}
                          </p>
                          <p className="text-xs text-muted-foreground mt-1 truncate">
                            {agent.description}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>
                </Card>

                {!collapsed && agent.subRoutes && active && (
                  <div className="pl-4 space-y-1">
                    {agent.subRoutes.map((subRoute) => {
                      const SubIcon = subRoute.icon;
                      const isSubRouteActive = pathname === subRoute.route;

                      return (
                        <Card
                          key={subRoute.route}
                          className={`cursor-pointer transition-all duration-200 border hover:shadow-sm ${
                            isSubRouteActive
                              ? "bg-primary/5 border-primary/30"
                              : "bg-card/50 hover:bg-accent/30 border-border/50"
                          }`}
                          onClick={() => handleNavigation(subRoute.route)}
                        >
                          <div className="p-2">
                            <div className="flex items-center gap-2">
                              <div
                                className={`w-6 h-6 rounded flex items-center justify-center transition-all ${
                                  isSubRouteActive
                                    ? "text-primary"
                                    : "text-muted-foreground"
                                }`}
                              >
                                <SubIcon className="w-4 h-4" />
                              </div>
                              <span
                                className={`text-xs ${
                                  isSubRouteActive
                                    ? "font-medium text-primary"
                                    : "text-muted-foreground"
                                }`}
                              >
                                {subRoute.name}
                              </span>
                            </div>
                          </div>
                        </Card>
                      );
                    })}
                  </div>
                )}
              </div>
            );
          })}
        </div>

        <div className="space-y-2">
          {!collapsed && (
            <div className="px-2 py-1">
              <div className="flex items-center gap-2">
                <h3 className="text-xs font-semibold text-green-600 uppercase tracking-wider">
                  Farm-to-Consumer üåæ
                </h3>
                <span className="text-xs bg-green-500 text-white px-1.5 py-0.5 rounded-full font-bold">
                  NEW
                </span>
              </div>
            </div>
          )}
          {agriHubExtension.map((agent) => {
            const IconComponent = agent.icon;
            const active = isActive(agent.route);

            return (
              <Card
                key={agent.route}
                className={`cursor-pointer transition-all duration-200 border hover:shadow-md ${
                  active
                    ? "bg-green-50 border-green-300 shadow-md ring-1 ring-green-300"
                    : "bg-card hover:bg-green-50/50 border-green-200 hover:border-green-300"
                }`}
                onClick={() => handleNavigation(agent.route)}
              >
                <div className="p-3">
                  <div className="flex items-center gap-3">
                    <div
                      className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all ${
                        active
                          ? "bg-green-500 text-white"
                          : "bg-gradient-to-br from-green-500 to-emerald-600 text-white"
                      }`}
                    >
                      <IconComponent className="w-5 h-5" />
                    </div>

                    {!collapsed && (
                      <div className="flex-1 min-w-0">
                        <h3
                          className={`font-semibold text-sm transition-colors ${
                            active ? "text-green-700" : "text-foreground"
                          }`}
                        >
                          {agent.name}
                        </h3>
                        <p className="text-xs text-green-600 font-medium truncate">
                          {agent.telugu}
                        </p>
                        <p className="text-xs text-muted-foreground mt-1 truncate">
                          {agent.description}
                        </p>
                      </div>
                    )}
                  </div>
                </div>
              </Card>
            );
          })}
        </div>
      </div>

      <div className="p-4 border-t border-border bg-background/50">
        <Button
          onClick={() => handleNavigation("/farmer")}
          variant="outline"
          className={`${
            collapsed ? "p-2" : "w-full"
          } border-border hover:bg-accent`}
        >
          {collapsed ? "üè†" : "üè† Back to Dashboard"}
        </Button>
      </div>
    </div>
  );
};

export default AgriAgentsSidebar;
